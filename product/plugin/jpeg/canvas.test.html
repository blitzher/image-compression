<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
        <script src="https://unpkg.com/gpu.js@latest/dist/gpu-browser.min.js"></script>
        <script src="./index.js"></script>

        <style>
            #canvas {
                min-width: 200px;
                image-rendering: crisp-edges;
            }
        </style>
    </head>
    <body>
        <canvas id="canvas"></canvas>
        <script>
            let mcu = [
                    [140, 144, 147, 140, 140, 155, 179, 175],
                    [144, 152, 140, 147, 140, 148, 167, 179],
                    [152, 155, 136, 167, 163, 162, 152, 172],
                    [168, 145, 156, 160, 152, 155, 136, 160],
                    [162, 148, 156, 148, 140, 136, 147, 162],
                    [147, 167, 140, 155, 155, 140, 136, 162],
                    [136, 156, 123, 167, 162, 144, 140, 147],
                    [148, 155, 136, 155, 152, 147, 147, 136],
                ],
                dct = JPEG.toDct(mcu),
                refDct = fdctControlImpl(mcu);

            readFile('./static/Untitled.png')
                .then((data) => [0, 1, 2].map((i) => getChannel(data, i)))
                .then((comps) => comps.map((x) => toBlocks(to2d(x, 16))))
                .then((comps) =>
                    comps.map((mcus) =>
                        mcus.map((row) => row.map((mcu) => JPEG.toDct(mcu))),
                    ),
                )
                .then((comps) => {
                    let out = comps.map((x) =>
                        x.map((y) => y.map((z) => JPEG.fromDct(z))),
                    );

                    out.forEach((x) => console.log(x));
                });

            //console.log('MCU: ');
            //console.table(mcu);

            //console.log('Reference dct: ');
            console.table(refDct);
            //console.table(idctControlImpl(refDct));

            //console.log('GPU dct: ');
            //console.table(dct);
            //console.table(JPEG.fromDct(dct));
        </script>
    </body>
</html>
